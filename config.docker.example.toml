[tieba]
# 要监控的贴吧列表，末尾不用带“吧”字
forums = [
  "forum_a",
  "forum_b"
]
# 历史回溯模式最大页数
max_backfill_pages = 100
# 是否在回溯模式中强制扫描所有贴子
backfill_force_scan = false

# （可选）分组配置
# [[tieba.groups]]
# name = "important"
# forums = ["important_forum"]
# interval_seconds = 15

# 提示：在 Docker Compose 中，你可以直接利用 environment 覆盖配置，
# 而无需修改此文件。例如在 docker-compose.yml 中添加：
# environment:
#   - TIEBA__FORUMS=["bar_1", "bar_2"]
#   - SCHEDULER__INTERVAL_SECONDS=30

# PostgreSQL 数据库连接信息和分区配置
# 请与 docker-compose.yml 配置保持一致
[database]
# 数据库主机地址
host = "postgres"
# 数据库端口（一般保持默认）
port = 5432
# 数据库用户名
username = "tiebascraper"
# 数据库密码
password = "tiebascraper"
# 数据库名称
db_name = "tieba_data"
# 是否启用 PostgreSQL 分区（TimescaleDB）
# Docker Compose 环境下默认启用
partition_enabled = true
# 分区间隔
p_interval = "1 month"

# 消费者配置
[consumer]
# 推送方式，可选"redis", "websocket"或"none"
# 推荐使用 redis，其作为中间件能够提供高可靠性
# websocket 无需依赖 redis，但不保证消息不丢失
# none 为不推送
transport = "redis"
# stream 或内部先进先出缓存队列的最大长度
max_len = 10000
# Redis stream 的前缀
stream_prefix = "scraper:tieba:events"

# 缓存配置
[cache]
# 缓存后端，可选"memory"或"redis"
backend = "redis"
# 缓存最大大小
# 仅在使用内存缓存时生效，过小可能造成缓存抖动
max_size = 100000
# 缓存过期时间（秒）
ttl_seconds = 86400

# Redis 连接信息
# 请与 docker-compose.yml 配置保持一致
[redis]
# Redis 主机地址
host = "redis"
# Redis 端口（一般保持默认）
port = 6379
# Redis 用户名（可留空）
username = ""
# Redis 密码（可留空）
password = ""
# Redis 数据库编号（一般为 0）
db = 0
# 指令请求 Stream 名称
# 用于动态添加/删除监控贴吧的命令通信
stream_request = "scraper:tieba:cmd:req"
# 指令响应 Stream 名称
# 用于命令响应的回传
stream_response = "scraper:tieba:cmd:res"

# WebSocket 服务配置
# 当消费者推送方式选择 websocket 时自动启用，否则不启用
[websocket]
# WebSocket Host
host = "0.0.0.0"
# WebSocket 端口
port = 8000
# WebSocket 路径（建议保持默认）
path = "/ws"
# 访问令牌（留空则不校验）
token = ""

# 监控配置
[metrics]
# 是否开启 Prometheus Metrics Server
enabled = true
# 监听端口
port = 8001

# 限流配置
[rate_limit]
# 并发数限制
concurrency = 10
# 遇 HTTP 429 后的全局冷却时间（秒）
cooldown_seconds_429 = 5.0
# 分接口 RPS 配置
# 贴吧服务端对各接口独立限流，使用令牌桶算法
# threads/posts 接口令牌桶容量≈60, 恢复速率≈2.0/s
# comments 接口限流较宽松
# get_threads 接口 RPS 限制
threads_rps = 2.0
# get_posts 接口 RPS 限制
posts_rps = 2.0
# get_comments 接口 RPS
comments_rps = 5.0

# 代理配置
[proxy]
# 是否启用代理
enabled = false
# 代理服务器 URL，支持以下格式：
# - socks5://host:port  (SOCKS5 代理)
# - socks5h://host:port (SOCKS5 代理，远程 DNS 解析)
# - socks4://host:port  (SOCKS4 代理)
# - http://host:port    (HTTP 代理)
# - https://host:port   (HTTPS 代理)
url = ""
# 代理认证用户名（可留空）
username = ""
# 代理认证密码（可留空）
password = ""
# 多代理轮换：配置多个代理 URL 可线性提升吞吐量
# 由于贴吧限流是基于 IP 的，N 个代理 = N 倍吞吐量
# 配置此项后将忽略上面的 url 配置
# urls = [
#     "socks5://proxy1:1080",
#     "socks5://proxy2:1080",
#     "socks5://proxy3:1080",
# ]

# 调度器配置
[scheduler]
# 以下配置项仅 periodic/hybrid 模式生效
# 调度周期，即每 N 秒投递一次首页任务
interval_seconds = 60
# 每 N 个周期投递一次精华贴首页任务
good_page_every_n_ticks = 10
# 队列感知调度：队列深度超过阈值时跳过本轮调度
# 设为 0 禁用此功能
queue_depth_threshold = 0
# 跳过调度后的等待时间（秒）
skip_wait_seconds = 5

# DeepScan 配置
[deep_scan]
# 是否启用 DeepScan 补偿扫描
enabled = false
# 扫描深度
# 即最多扫描前 n 页 + 后 n 页
depth = 3
